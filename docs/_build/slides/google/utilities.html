<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python Utilities &mdash; Treinamento de Python 2016.08.0001</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="../_static/single.css" type="text/css" />
    
    <link rel="stylesheet" href="../_static/odoo.css" type="text/css" />
    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2016.08.0001',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/common.js"></script>
    
    <script type="text/javascript" src="../_static/slides.js"></script>
    <script type="text/javascript" src="../_static/sync.js"></script>
    <script type="text/javascript" src="../_static/controller.js"></script>
    <script type="text/javascript" src="../_static/init.js"></script>
    
    
    <script type="text/javascript" src="../_static/odoo.js"></script
    
    <link rel="top" title="Treinamento de Python 2016.08.0001" href="../index.html" />
    <link rel="next" title="Referências" href="../references/references.html" />
    <link rel="prev" title="Expressões Regulares" href="regular-expressions.html" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  
<article class="slide level-1" id="python-utilities">

<h1>Python Utilities</h1>





</article>
<article class="slide level-2" id="id1">

<h2>Python Utilities</h2>

<p>Nesta sessão, vamos dar uma olhada em algumas das muitas funções da biblioteca
padrão do Python, visando resolver problemas comuns.</p>




</article>
<article class="slide level-2" id="file-system-os-os-path-shutil">

<h2>File System -- os, os.path, shutil</h2>

<p>Os modulos <strong>os</strong> e <strong>os.path</strong> contêm muitas funcionalidades para interagir
com o sistema operacional.</p>
<p>O módulo <strong>shutil</strong> pode copiar arquivos</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.python.org/lib/module-os.html/">os module docs</a></li>
<li>filenames = os.listdir(dir) - lista o nome dos arquivos no diretório (não incluindo path atual . e path pai ..). Os nomes dos arquivos são apenas os nomes dos arquivos e não os seus caminhos absolutos.</li>
<li>os.path.join(dir, filename) - recupera o nome de arquivo da lista acima, usar isso para colocar o diretório (path) e nome do arquivo em conjunto para fazer um caminho completo</li>
<li>os.path.abspath(path) - recupera um caminho, retorna a forma absoluta, por exemplo, /home/nick/foo/bar.html</li>
<li>os.path.dirname(caminho), os.path.basename (path) - recupera o caminho completo dir/foo/bar.html, retorna o diretório &quot;dir/foo&quot; e nome do arquivo &quot;bar.html&quot;</li>
</ul>




</article>
<article class="slide level-2" id="id2">

<h2>File System -- os, os.path, shutil</h2>

<ul class="simple">
<li>os.path.exists(path) -- true if it exists</li>
<li>os.mkdir(dir_path) -- makes one dir, os.makedirs(dir_path) makes all the needed dirs in this path</li>
<li>shutil.copy(source-path, dest-path) -- copy a file (dest path directories should exist)</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">## Example pulls filenames from a dir, prints their relative and absolute paths</span>
<span class="k">def</span> <span class="nf">printdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
  <span class="n">filenames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">filename</span>  <span class="c1">## foo.txt</span>
    <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span> <span class="c1">## dir/foo.txt (relative to current dir)</span>
    <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span> <span class="c1">## /home/nick/dir/foo.txt</span>
</pre></div>
</div>
<p>Explorar um módulo funciona muito bem com as funções da <strong>biblioteca
padrão</strong>: help() e dir().</p>
<p>No interpretador execute um import os e use os comandos para avaliar os
módulos: dir(os), help(os.listdir), dir(os.path), help(os.path.dirname).</p>




</article>
<article class="slide level-2" id="running-external-processes-commands">

<h2>Running External Processes -- commands</h2>

<p>O modulo <strong>commands</strong> é uma forma simples de executar um comando externo e
capturar sua saída.</p>
<ul class="simple">
<li>commands module docs</li>
<li>(status, output) = commands.getstatusoutput(cmd) -- executa o comando, aguarda a execução para sair e retorna status int e texto de saída como uma tupla. O comando é executado com sua saída padrão e erro padrão combinado em uma única saída de texto. O status será diferente de zero se o comando falhou. Desde que o standar-err do comando seja capturado, se ele falhar, é preciso imprimir alguma indicação sobre o que aconteceu.</li>
<li>output = commands.getoutput(cmd) -- como o comando acima, mas sem o status int.</li>
<li>Há o commands.getstatus(), mas ele faz outra coisa, por isso não utilize.</li>
</ul>




</article>
<article class="slide level-2" id="id3">

<h2>Running External Processes -- commands</h2>

<ul class="simple">
<li>Se você gostaria de ter mais controle dos sub-processos que estão rodando, veja o módulo &quot;popen2&quot; (<a class="reference external" href="http://docs.python.org/lib/module-popen2.html">http://docs.python.org/lib/module-popen2.html</a>)</li>
<li>Há também o simples os.system(cmd), que executa o comando e retorna sua saída e retorna seu código de erro. Isso funciona se você deseja executar o comando, mas não precisa capturar a sua saída em suas estruturas de dados python.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">## Given a dir path, run an external &#39;ls -l&#39; on it --</span>
<span class="c1">## shows how to call an external program</span>
<span class="k">def</span> <span class="nf">listdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
  <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;ls -l &#39;</span> <span class="o">+</span> <span class="nb">dir</span>
  <span class="k">print</span> <span class="s2">&quot;Command to run:&quot;</span><span class="p">,</span> <span class="n">cmd</span>   <span class="c1">## good to debug cmd before actually running it</span>
  <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getstatusoutput</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">status</span><span class="p">:</span>    <span class="c1">## Error case, print the command&#39;s output to stderr and exit</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">print</span> <span class="n">output</span>  <span class="c1">## Otherwise do something with the command&#39;s output</span>
</pre></div>
</div>




</article>
<article class="slide level-2" id="excessoes">

<h2>Excessões</h2>

<p>Uma exceção representa um erro de tempo de execução que suspende a execução normal
em uma linha particular e transfere o controle para manipulação de erros de código.
Esta seção apenas introduz os usos mais básicos de exceções. Por exemplo, num erro
de tempo de execução pode ser que uma variável utilizada no programa não tenha um
valor (ValueError... você provavelmente já viu este erro algumas vezes), ou um erro
de operação de abertura de arquivo por causa do arquivo não existir ( IOError).
(Veja docs <a class="reference external" href="http://docs.python.org/tut/node10.html][exception~~number=plural">http://docs.python.org/tut/node10.html][exception~~number=plural</a>)</p>




</article>
<article class="slide level-2" id="id4">

<h2>Excessões</h2>

<p>Sem qualquer código de manipulação de erro (como temos feito até agora), uma
exceção de tempo de execução apenas interrompe o programa com uma mensagem de erro.
Isso é um bom comportamento padrão, e você já viu isso muitas vezes. Você pode adicionar
uma estrutura &quot;try/except&quot; no seu código para lidar com exceções, como esta:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="c1">## Either of these two lines could throw an IOError, say</span>
  <span class="c1">## if the file does not exist or the read() encounters a low level error.</span>
  <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rU&#39;</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
  <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
  <span class="c1">## Control jumps directly to here if any of the above lines throws IOError.</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;problem reading:&#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
<span class="c1">## In any case, the code then continues with the line after the try/except</span>
</pre></div>
</div>




</article>
<article class="slide level-2" id="id5">

<h2>Excessões</h2>

<p>A tentativa: seção inclui o código que pode lançar uma exceção.
A exceção: seção contém o código para ser executado se houver uma exceção.
Se não houver nenhuma exceção, a exceção: a seção é ignorada (isto é, que
o código é para a manipulação de erro somente, não é o caso &quot;normal&quot; para
o código).</p>
<p>Você pode obter um ponteiro para a exceção do próprio objeto com
a sintaxe <code class="docutils literal"><span class="pre">except</span> <span class="pre">IOError,</span> <span class="pre">e:</span></code> (e aponta para o objeto de exceção).</p>




</article>
<article class="slide level-2" id="http-urllib-and-urlparse">

<h2>HTTP -- urllib and urlparse</h2>

<p>O módulo <strong>urllib</strong> permite acessar servidores HTTP por meios de requests GET
e POST de maneira direta -- Tornando as urls acessíveis como um arquivo que
possa ser lido. O <strong>urlparse</strong> permite a você trabalhar com partes de url e unir urls.</p>
<p>-urllib module docs
-ufile = urllib.urlopen(url) -- returns a file like object for that url
-text = ufile.read() -- can read from it, like a file (readlines() etc. also work)
-info = ufile.info() -- the meta info for that request. info.gettype() is the  mime time, e.g. 'text/html'
-baseurl = ufile.geturl() -- gets the &quot;base&quot; url for the request, which may be different from the original because of redirects
-urllib.urlretrieve(url, filename) -- downloads the url data to the given file path
-urlparse.urljoin(baseurl, url) -- given a url that may or may not be full, and the baseurl of the page it comes from, return a full url. Use geturl() above to provide the base url.</p>




</article>
<article class="slide level-2" id="id6">

<h2>HTTP -- urllib and urlparse</h2>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">## Given a url, try to retrieve it. If it&#39;s text/html,</span>
<span class="c1">## print its base url and its text.</span>
<span class="k">def</span> <span class="nf">wget</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
  <span class="n">ufile</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>  <span class="c1">## get file-like object for url</span>
  <span class="n">info</span> <span class="o">=</span> <span class="n">ufile</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>   <span class="c1">## meta-info about the url content</span>
  <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">gettype</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;text/html&#39;</span><span class="p">:</span>
    <span class="k">print</span> <span class="s1">&#39;base url:&#39;</span> <span class="o">+</span> <span class="n">ufile</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">ufile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  <span class="c1">## read all its text</span>
    <span class="k">print</span> <span class="n">text</span>
</pre></div>
</div>
<p>O código acima funciona bem, mas não inclui tratamento de erros caso a url
não exista. Segue uma versão de uma função que adiciona a lógica try/except
exibindo uma mensagem em caso de erro.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">## Version that uses try/except to print an error message if the</span>
<span class="c1">## urlopen() fails.</span>
<span class="k">def</span> <span class="nf">wget2</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">ufile</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ufile</span><span class="o">.</span><span class="n">info</span><span class="p">()</span><span class="o">.</span><span class="n">gettype</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;text/html&#39;</span><span class="p">:</span>
      <span class="k">print</span> <span class="n">ufile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
  <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
    <span class="k">print</span> <span class="s1">&#39;problem reading url:&#39;</span><span class="p">,</span> <span class="n">url</span>
</pre></div>
</div>




</article>
<article class="slide level-2" id="exercise">

<h2>Exercise</h2>

<p>Log Puzzle Exercise.</p>




</article>

</section>

<section id="slide_notes">

</section>

  </body>
</html>